# 다중 처리기 스케줄링(Multiple-Processor Scheduling)
만약 여러개의 CPU가 사용 가능하다면 부하 공유(load sharing)가 가능해진다. 그러나 스케줄링 문제는 그에 상응하여 더욱 복잡해진다. 한 처리기의 사유 버스에 부착된 입출력 장치를 가진 시스템을 고려해 보자. 그 장치를 사용하고자 하는 프로세스는 반드시 그 처리기에서 수행되도록 스케줄 되어야 한다.
***

## 다중 처리기 스케줄링에 대한 접근 방법(Approaches to Multiple-Processor Scheduling)
* 비대칭 다중처리(asymmetric multiprocessing)
    * 하나의 처리기 : 스케줄링 결정, 입출력 처리, 다른 시스템의 활동을 취급
    * 다른 처리기들은 사용자 코드만 수행
* 대칭 다중처리(symmetric multiprocessing, SMP)
    * 각 처리기 : 스케줄링
    * 모든 프로세스는 공동의 준비 완료 큐 또는 각 처리기 마다 있는 준비 완료 큐에 있게 된다.
    * 각 처리기의 스케줄러가 큐를 검사하여 실행할 프로세스를 선택
* 현대의 운영체제 = SMP 지원

## 처리기 친화성(Processor Affinity)
* 만약 한 처리기에서 처리되던 프로세스가 다른 처리기로 이동되면 비효율적일 것 이다.
* 때문에 계속해서 같은 처리기에서 처리할려는 현상을 처리기 친화성이라고 한다.
    * 연성 친화성(soft affinity) : 동일한 처리기에서 실행하려고 노력은 하되 보장은 안함
    * 강성 친화성(hard affinity) : 시스템 콜을 통해 프로세스가 자신이 실행될 처리기를 지정할 수 있음

## 부하 균등화(Load Balancing)
* 처리기가 여러개이기 때문에 부하를 배분하는것은 중요하다.
* 부하 균등화(load balancing)이란 SMP시스템의 모든 처리기 사이에 부하가 고르게 배분되도록 하는것을 뜻한다.
* 하지만 SMP를 지원하는 대부분의 운영체제에선 각 처리기마다 자신만의 큐가 있다.
* 부하 균등화를 위해서는 push migration과 pull migration 방식이 있다.
    * push migration : 특정 태스크가 주기적으로 각 처리기의 부하를 검사하고 불균형을 발견하면 덜 바쁜 처리기로 프로세스를 push한다.
    * pull migration : 쉬고있는 처리기가 바쁜 처리기를 기다리고 있는 프로세스를 pull한다.
* 처리기 친화성 vs 부하 균등화 -> 상황에 따라서 판단

## 다중코어 프로세서(Multicore Processors)
* SMP시스템은 다수의 물리 처리기를 제공함으로서 다수의 스레드가 동시에 실행되게 한다.
* 보통은 하나의 칩 안에 여러 개의 처리기 코어를 넣는것을 다중코어 프로세서(multicore processor)라고 한다.
* 운영체제 입장에서는 별개의 물리 처리기처럼 보이게 된다.
* 다중코어 프로세서는 스케줄링 문제를 복잡하게 한다.
* 프로세서가 메모리를 접근할 때 데이터가 가용해지기를 기다리면서 많은 시간을 허비하는 것을 메모리 멈춤(memory stall)이라고 한다.
* 운영체제 관점에서 각 하드웨어 스레드는 소프트웨어 스레드를 실행할 수 있는 논리 프로세서로 보인다.
* 때문에 다중 스레드를 사용하면 메모리 멈춤을 어느정도 무시할 수 있다.
    * 거친(coarse-grained) 다중 스레딩 : 메모리 멈춤처럼 긴 지연시간을 가진 사건이 발생할 때 한 처리기에서 수행
    * 세밀한(fine-grained) 다중 스레딩 : 보통 명령어 주기의 경계같은 부분에서 일어남
