# 스레딩 이슈(Threading Issues)
다중 스레드 프로그램을 설계할 때 고려해야될 문제는 무엇이 있을까?
***

## Fork, Exec 시스템 콜
* 다중 스레드 프로그램에서는 fork와 exec의 의미가 달라질 수 있다.
* fork
    * 몇 개의 스레드를 복제하는가?
    * 한 개의 스레드만 가지는 프로세스이어야 하는가>
    * fork를 호출한 스레드만 복제하는가?
* exec를 호출하면 모든 스레드를 포함한 전체 프로세스를 대체한다.

## 신호 처리(Signal Handling)
* 신호는 UNIX에서 프로세스에게 어떤 사건이 일어났음을 알려주기 위해 사용된다.
* 신호는 동기식 또는 비동기식으로 전달될 수 있다.
    * 신호는 특정 사건이 일어나야 생성됨
    * 생성된 신호가 프로세스에게 전달됨
    * 신호가 전달되면 반드시 처리되어야 함
* 모든 신호는 둘 중 하나의 처리기에 의해 처리된다.
    * 디폴트 신호 처리기
    * 사용자 정의 처리기
* 모든 신호는 디폴트 신호 처리기가 처리를 하지만 사용자 정의 처리기로 대체될 수 있다.
* 신호는 어느 스레드에게 전달되는가?
    * 신호가 적용될 스레드에게 전달한다.
    * 모든 스레드에게 전달한다.
    * 몇몇 스레드에게만 전달한다.
    * 특정 스레드가 모든 신호를 받게 한다.
* Windows는 신호를 명시적으로 지원하지는 않으나 비동기식 프로시저 호출(Asynchronous Procedure Calls, APC)을 사용해 간접적으로 실행할 수 있다.

## 취소(Cancellation)
* 스레드의 취소는 스레드가 끝나기 전에 그것을 강제 종료시키는 것을 말한다.
* 취소되어야 할 스레드를 타겟 스레드(target thread)라 한다.
    * 비동기식 취소(Asynchronous Cancellation): 즉시 스레드를 종료
    * 지연 취소(Deferred Cancellation): 주기적으로 자신이 종료되어야 하는지 점검
* 스레드를 취소할 때 자원이 크게 문제가 된다.
* Ptrhead에서 지연 취소는 스레드가 cancllation point에 도달했을 때 취소작업이 일어난다.
* 최소점을 만드는 방법은 특정 함수를 호출하는 것 이다.
* 취소 요청이 대기 중 이라는게 발견되면 cleanup handelr가 호출된다.

## 스레드 로컬 저장소(Thread-Local Storage, TLS)
* 스레드들은 그 프로세스의 데이터를 공유한다.
* 각 스레드가 자기만 액세스할 수 있는 데어터를 가져야 한다.
* 이 장소가 바로 TLS이다.

## 스케줄러 액티베이션(Scheduler Activations)
* 스레드 라이브러리와 커널의 통신 문제가 있다.
* 다대다 모델에서는 반드시 해결해야 할 문제다.
* 사용자와 커널 스레드 사이에 경량 프로세스(LWP)를 두는 것 이다.
* 각 LWP는 하나의 커널 스레드에 부속되어 있으며 물리 처리기에서 스케줄 하는 대상은 바로 이 커널 스레드이다.
* 동시에 발생하는 블로킹 시스템 호출 하나당 하나의 LWP가 필요하다.
* 사용자 스레드와 커널 스레드 간의 통신 방법 중 하나는 스케줄러 액티베이션이다.
* 스케줄러 액티베이션이란 커널이 응용 프로그램에게 LWP의 집합을 제공하고 응용 프로그램은 사용자 스레드를 사용하는 가상 처리기로 스케줄링 한다.
* 커널은 응용 프로그램에게 인터럽트에 대해 알려줘야 한다
* 이 프로시저를 upcall이라 부른다.
* upcall은 스레드 라이브러리의 upcall 처리기에 의해 처리된다.



